<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>vembudar.se – Upphandlingar (TED)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px}
    .grid{display:grid;gap:12px}
    .card{border:1px solid #e5e7eb;border-radius:10px;padding:12px}
    .muted{color:#6b7280}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #d1d5db;border-radius:999px;font-size:12px;margin-right:6px}
  </style>
</head>
<body>
  <h1>Aktuella upphandlingar (TED, Sverige)</h1>
  <p class="muted">Datan uppdateras automatiskt via GitHub Actions. Källa: TED.</p>
  <div id="meta" class="muted"></div>
  <div id="list" class="grid"></div>

  <script>
    async function load() {
      const res = await fetch("data/ted.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Kunde inte läsa data/ted.json");
      const data = await res.json();

      // meta
      document.getElementById("meta").textContent =
        `Senast uppdaterad: ${new Date(data.fetchedAt).toLocaleString()} – Poster: ${data.count}`;

      const list = document.getElementById("list");
      list.innerHTML = "";

      (data.notices || []).slice(0, 20).forEach(n => {
        const wrap = document.createElement("div");
        wrap.className = "card";
        const title = n.title || "Utan titel";
        const buyer = n.buyer || "Okänd upphandlare";
        const pub = n.publicationDate ? new Date(n.publicationDate).toLocaleDateString() : "—";
        const ddl = n.deadline ? new Date(n.deadline).toLocaleDateString() : "—";
        const value = n.estimatedValue ? `${n.estimatedValue} ${n.currency || ""}` : "—";
        const ted = n.tedUrl ? `<a href="${n.tedUrl}" target="_blank" rel="noopener">Öppna på TED</a>` : "";

        const cpv = Array.isArray(n.cpv) ? n.cpv.slice(0,3).map(c => `<span class="pill">${c.code || c}</span>`).join("") : "";
        const nuts = Array.isArray(n.nuts) ? n.nuts.slice(0,3).map(x => `<span class="pill">${x.code || x}</span>`).join("") : "";

        wrap.innerHTML = `
          <div><strong>${title}</strong></div>
          <div class="muted">${buyer}</div>
          <div>Publicerad: ${pub} · Sista anbudsdag: ${ddl}</div>
          <div>Värde: ${value}</div>
          <div>${cpv} ${nuts}</div>
          <div style="margin-top:6px">${ted}</div>
        `;
        list.appendChild(wrap);
      });
    }
    load().catch(e => {
      document.getElementById("list").textContent = "Fel: " + e.message;
    });
  </script>
</body>
</html>
