<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bollkamp Pro</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #333;
            font-family: Arial, sans-serif;
        }

        #gameArea {
            position: relative;
            width: 90%;
            height: 90%;
            margin: 2% auto;
            background-color: #fff;
            border: 3px solid #444;
        }

        .ball {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: transform 0.1s;
        }

        #redBall {
            background-color: #ff0000;
            z-index: 2;
        }

        #greenBall {
            background-color: #00ff00;
            z-index: 1;
        }

        #score {
            position: absolute;
            top: 10px;
            right: 10px;
            color: black;
            font-size: 24px;
            font-weight: bold;
            z-index: 3;
            text-shadow: 1px 1px 2px white;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <div id="score">Poäng: 0</div>
        <div id="redBall" class="ball"></div>
        <div id="greenBall" class="ball"></div>
    </div>

    <script>
        const redBall = document.getElementById('redBall');
        const greenBall = document.getElementById('greenBall');
        const gameArea = document.getElementById('gameArea');
        const scoreElement = document.getElementById('score');

        // Game state
        let redX = gameArea.offsetWidth/2 - 20;
        let redY = gameArea.offsetHeight/2 - 20;
        let greenX = 100;
        let greenY = 100;
        let score = 0;
        let previousRedX = redX;
        let previousRedY = redY;
        let velocityX = 0;
        let velocityY = 0;
        
        // Green ball physics
        let greenSpeedX = 0;
        let greenSpeedY = 0;
        const friction = 0.99;
        const maxSpeed = 15;

        // Initialize positions
        redBall.style.left = redX + 'px';
        redBall.style.top = redY + 'px';
        greenBall.style.left = greenX + 'px';
        greenBall.style.top = greenY + 'px';

        // Touch handling
        let touchStartX = 0;
        let touchStartY = 0;

        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;

            // Calculate movement relative to game area
            const rect = gameArea.getBoundingClientRect();
            redX += (touchX - touchStartX) - rect.left;
            redY += (touchY - touchStartY) - rect.top;

            // Contain red ball within game area
            redX = Math.max(0, Math.min(gameArea.offsetWidth - 40, redX));
            redY = Math.max(0, Math.min(gameArea.offsetHeight - 40, redY));

            redBall.style.left = redX + 'px';
            redBall.style.top = redY + 'px';

            touchStartX = touchX;
            touchStartY = touchY;
        }

        // Physics engine
        function updatePhysics() {
            // Calculate red ball velocity
            velocityX = redX - previousRedX;
            velocityY = redY - previousRedY;
            previousRedX = redX;
            previousRedY = redY;

            // Update green ball position with friction
            greenX += greenSpeedX;
            greenY += greenSpeedY;
            greenSpeedX *= friction;
            greenSpeedY *= friction;

            // Wall collisions with momentum preservation
            if(greenX <= 0 || greenX >= gameArea.offsetWidth - 40) {
                greenSpeedX *= -0.9;
                greenX = Math.max(0, Math.min(gameArea.offsetWidth - 40, greenX));
            }
            if(greenY <= 0 || greenY >= gameArea.offsetHeight - 40) {
                greenSpeedY *= -0.9;
                greenY = Math.max(0, Math.min(gameArea.offsetHeight - 40, greenY));
            }
        }

        // Collision handling
        function handleCollisions() {
            const dx = greenX - redX;
            const dy = greenY - redY;
            const distance = Math.sqrt(dx*dx + dy*dy);

            if(distance < 40) {
                // Calculate collision vector
                const angle = Math.atan2(dy, dx);
                const redSpeed = Math.sqrt(velocityX*velocityX + velocityY*velocityY);
                
                // Transfer momentum
                const force = Math.min(redSpeed * 2.5, maxSpeed);
                greenSpeedX = Math.cos(angle) * force;
                greenSpeedY = Math.sin(angle) * force;

                // Update score and effects
                score++;
                scoreElement.textContent = `Poäng: ${score}`;
                greenBall.style.transform = `scale(1.3) translate(${Math.cos(angle)*5}px, ${Math.sin(angle)*5}px)`;
                setTimeout(() => greenBall.style.transform = 'scale(1) translate(0,0)', 200);
            }
        }

        // Render loop
        function gameLoop() {
            updatePhysics();
            handleCollisions();
            greenBall.style.left = greenX + 'px';
            greenBall.style.top = greenY + 'px';
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        gameArea.addEventListener('touchstart', handleTouchStart);
        gameArea.addEventListener('touchmove', handleTouchMove);

        // Start game
        gameLoop();
    </script>
</body>
</html>
